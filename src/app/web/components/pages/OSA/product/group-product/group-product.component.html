<app-breadcrumb-menu [items_menu]="items_menu" [home]="home"></app-breadcrumb-menu>

<div class="grid animation-duration-500 box">
    <div class="col-12">
        <div class="card">
            <div class="row">
                <div class="md:col-3">
                    <h6>Group Code</h6>
                    <input [style]="{'minWidth':'100%'}" type="text" pInputText [(ngModel)]="group_code"
                        placeholder="Search by Group Code">
                </div>

                <div class="md:col-3">
                    <h6>Group Name</h6>
                    <input [style]="{'minWidth':'100%'}" type="text" pInputText [(ngModel)]="group_name"
                        placeholder="Search by Group Name">
                </div>
            </div>
        </div>
    </div>
</div>

<div class="grid">
    <div class="col-12">
        <p-toolbar>
            <div class="p-toolbar-group-left flex flex-wrap">
                <button pButton type="button " label="Filter" [loading]="isLoading_Filter" icon="pi pi-search "
                    (click)="LoadData(1)" class="p-button-sm mr-2 mt-2"></button>

                <button type="button" (click)="exportRawData()" label="Raw data" pButton pRipple icon="pi pi-file-excel"
                    style="float: right" class="p-button-sm mr-2 mt-2"></button>

                <!-- <p-splitButton label="Import Data" icon="pi pi-bars" styleClass="p-button-sm mr-2 mt-2"
                    [model]="itemsImport"></p-splitButton> -->

                <button pButton pRipple label="Import excel" icon="pi pi-upload" (click)="showImportDialog()"
                    class="p-button-sm mr-2 mt-2"></button>

                <button pButton pRipple label="Get Template" icon="pi pi-file-export" (click)="getTemplate()"
                    class="p-button-sm mr-2 mt-2"></button>

                <i class="pi pi-bars p-toolbar-separator"></i>

                <button pButton type="button" pTooltip="Show Filter" pStyleClass=".box" enterClass="hidden"
                    enterActiveClass="fadeinup" (click)="ShowHideFilter()" tooltipPosition="top" icon="pi pi-eye"
                    class=" p-button-success mr-2 mt-2"
                    [ngStyle]="{'display': showFilter === 1 ? 'none' : 'flex'}"></button>

                <button pButton type="button" pTooltip="Hide Filter" (click)="ShowHideFilter()" tooltipPosition="top"
                    icon="pi pi-eye-slash" class="p-button-warning mr-2 mt-2" pStyleClass=".box"
                    leaveActiveClass="fadeoutup" leaveToClass="hidden"
                    [ngStyle]="{'display': showFilter === 0 ? 'none' : 'flex'}"></button>
            </div>
        </p-toolbar>
    </div>
</div>

<div class="grid animation-duration-500 box">
    <div class="col-12 flex">
        <div class="card flex flex-row align-items-center justify-content-between w-12 gap-5" *ngIf="showImport === 1">
            <p-toolbar class="w-6">
                <div class="p-toolbar-group-start flex-row align-items-center justify-content-between w-full">
                    <input class="form-control w-11" type="file" #myInput (change)="onChangeFile($event)" />

                    <button pButton pRipple (click)="import()" label="Upload" icon="pi pi-upload"
                        class="p-button-sm p-button-success mr-2 ml-2 w-2"></button>
                </div>
            </p-toolbar>

            <p-toolbar class="w-6">
                <div class="card" *ngIf="dataError">
                    <p-table #dt [columns]="cols" [value]="dataError" selectionMode="multiple"
                        [exportHeader]="'customExportHeader'" [tableStyle]="{ 'min-width': '30rem' }">
                        <ng-template pTemplate="caption">
                            <div class="flex">
                                <button type="button" pButton pRipple icon="pi pi-file-excel" (click)="exportExcel()"
                                    class="p-button-success ml-auto" pTooltip="XLS" tooltipPosition="bottom"></button>
                            </div>
                        </ng-template>

                        <ng-template pTemplate="header" let-columns>
                            <tr>
                                <th *ngFor="let col of columns">
                                    {{ col.header }}
                                </th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-rowData let-columns="columns">
                            <tr [pSelectableRow]="rowData">
                                <td *ngFor="let col of columns">
                                    <p>{{ rowData[col.field] }}</p>
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </p-toolbar>
        </div>
    </div>
</div>

<div class="card">
    <p-toast></p-toast>
    <p-toolbar styleClass="mb-4 gap-2">
        <ng-template pTemplate="left">
            <button pButton pRipple label="New" icon="pi pi-plus" class="p-button-sm p-button-success mr-2 mt-2"
                (click)="openNew()"></button>
        </ng-template>

        <ng-template pTemplate="right">

        </ng-template>
    </p-toolbar>
    <p-table #dt [value]="ListGroupProduct" [rows]="10" [(selection)]="selectedGroupCode" [rowHover]="true"
        dataKey="category_id" currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
        [showCurrentPageReport]="true" [paginator]="true" [scrollable]="true" styleClass="p-datatable-gridlines"
        [globalFilterFields]="['order, created_name', 'created_date']">

        <ng-template pTemplate="header">
            <tr>
                <th class="text-center">Group Code</th>
                <th class="text-center">Group Name</th>
                <th class="text-center" pSortableColumn="order">Order <p-sortIcon field="order"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="created_name">Created by <p-sortIcon field="created_name">
                    </p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="created_date">Created date <p-sortIcon field="created_date">
                    </p-sortIcon>
                </th>
                <th class="text-center">Action</th>
            </tr>
            <tr>
                <th>
                    <p-columnFilter type="text" field="group_code" placeholder="Search Group Code"
                        ariaLabel="Filter Group Code" />
                </th>
                <th>
                    <p-columnFilter type="text" field="group_name" placeholder="Search Group Name"
                        ariaLabel="Filter Group Name" />
                </th>
                <th>
                    <p-columnFilter type="text" field="order" placeholder="Search Order" ariaLabel="Filter Order" />
                </th>
                <th>
                    <p-columnFilter type="text" field="created_name" placeholder="Search Created by"
                        ariaLabel="Filter Created by" />
                </th>
                <th>
                    <p-columnFilter type="text" field="created_date" placeholder="Search Created date"
                        ariaLabel="Filter Created date" />
                </th>
                <th></th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-groupProduct>
            <tr>
                <td>{{groupProduct.group_code}}</td>
                <td>
                    {{groupProduct.group_name}}
                </td>
                <td>
                    {{groupProduct.order}}
                </td>
                <td> {{groupProduct.created_name}} </td>
                <td> {{groupProduct.created_date}} </td>
                <td>
                    <div class="text-center flex flex-row align-items-center justify-content-around h-full">
                        <button class="p-button-rounded p-button-text" style="font-size: 2.5rem" title="Edit" 
                            (click)="openEdit(groupProduct)" pButton pRipple type="button" icon="pi pi-pencil"></button>
                        <button class="p-button-rounded p-button-danger p-button-text" style="font-size: 2.5rem" title="Delete"
                            (click)="deleteCategory(groupProduct, $event)" pButton pRipple type="button" icon="pi pi-trash">
                        </button>     
                        <p-confirmPopup></p-confirmPopup>
                    </div>
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="summary">
            <div class="flex align-items-center justify-content-between">
                In total there are {{ ListGroupProduct ? ListGroupProduct.length : 0 }} list category.
            </div>
        </ng-template>
    </p-table>
</div>

<p-dialog [(visible)]="showAddDialog" [style]="{ width: '40rem' }" header="Add new Group Code" [modal]="true"
    styleClass="p-fluid">
    <ng-template pTemplate="content">
        <div class="wrapper-id-type flex flex-row w-full h-fit align-items-center justify-content-between gap-3">
            <div class="field w-8">
                <label for="group_code">Group Code<span class="font-bold" style="color: red;"> *</span></label>
                <input type="text" pInputText id="group_code" [(ngModel)]="group_code"
                    placeholder="Please fill in Group Code" />
            </div>
            <div class="field w-4">
                <label for="order">Order<span class="font-bold" style="color: red;"> *</span></label>
                <input type="text" pInputText id="order" [(ngModel)]="order" placeholder="Please fill in Order" />
            </div>
        </div>
        <div class="field w-full">
            <label for="group_name">Group Name<span class="font-bold" style="color: red;"> *</span></label>
            <input type="text" pInputText id="group_name" [(ngModel)]="group_name"
                placeholder="Please fill in Group Name" />
        </div>
    </ng-template>

    <ng-template pTemplate="footer">
        <!-- <button pButton pRipple label="Cancel" icon="pi pi-times" class="p-button-text" (click)="hideDialog()"></button> -->

        <button pButton pRipple label="Save" icon="pi pi-check" class="p-button-text"
            (click)="saveGroupProduct($event)"></button>
    </ng-template>
</p-dialog>

<p-dialog [(visible)]="showEditDialog" [style]="{ width: '40rem' }" header="Edit Group Code" [modal]="true"
    styleClass="p-fluid">
    <ng-template pTemplate="content">
        <div class="wrapper-id-type flex flex-row w-full h-fit align-items-center justify-content-between gap-3">
            <div class="field w-8">
                <label for="group_code">Group Code<span class="font-bold" style="color: red;"> *</span></label>
                <input type="text" pInputText id="group_code" [ngModel]="edit_group_code" [disabled]="false" />
            </div>

            <div class="field w-4">
                <label for="order">Order<span class="font-bold" style="color: red;"> *</span></label>
                <input type="text" pInputText id="order" [(ngModel)]="edit_order" [disabled]="false" />
            </div>
        </div>
        <div class="field w-full">
            <label for="group_name">Group Name<span class="font-bold" style="color: red;"> *</span></label>
            <input type="text" pInputText id="group_name" [(ngModel)]="edit_group_name" [disabled]="false" />
        </div>
    </ng-template>

    <ng-template pTemplate="footer">
        <!-- <button pButton pRipple label="Cancel" icon="pi pi-times" class="p-button-text" (click)="hideDialog()"></button> -->
        <button pButton pRipple label="Confirm" icon="pi pi-check" class="p-button-text"
            (click)="editGroupCode()"></button>
    </ng-template>
</p-dialog>

<p-confirmDialog></p-confirmDialog>
