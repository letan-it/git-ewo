<!-- eslint-disable @angular-eslint/template/eqeqeq -->
<app-breadcrumb-menu
    [items_menu]="items_menu"
    [home]="home"
></app-breadcrumb-menu>

<div class="grid" *ngIf="false">
    <div class="col-12">
        <div class="card">
            <h4>Empty Page</h4>
            <p>
                This is your empty page template to start building beautiful
                applications.
            </p>
        </div>
    </div>
</div>
<section>
    <div class="grid animation-duration-500 box">
        <div class="col-12">
            <div class="card">
                <div class="row">
                    <div class="md:col-3">
                        <h6>Product Code</h6>
                        <input
                            [style]="{ minWidth: '100%' }"
                            type="text"
                            pInputText
                            [(ngModel)]="product_code"
                            placeholder="List Product Code"
                        />
                    </div>
                    <div class="md:col-3">
                        <h6>Product Name</h6>
                        <input
                            [style]="{ minWidth: '100%' }"
                            type="text"
                            pInputText
                            [(ngModel)]="product_name"
                            placeholder="Product Name"
                        />
                    </div>
                    <!-- <div class="md:col-2">
                        <h6>Choose Columns Category Name</h6>
                        <p-multiSelect
                            [options]="catsName"
                            [showToggleAll]="false"
                            [showClear]="true"
                            [filter]="true"
                            filterBy="name"
                            [virtualScroll]="true"
                            display="chip"
                            [filter]="true"
                            [style]="{ minWidth: '100%', minHeight: 'fit-content' }"
                            class="multiselect-custom-virtual-scroll p-fluid mt-2"
                            [(ngModel)]="selectedCatNameArr"
                            optionLabel="name"
                            placeholder="Select Info Customer"
                            appendTo="body"
                            (onChange)="selectedCatName($event)"
                            (onClear)="onClearType()"
                        >
                            <ng-template let-infoCustomerArr pTemplate="item">
                                <div class="flex align-items-center gap-2">
                                    <div>{{ infoCustomerArr?.name }}</div>
                                </div>
                            </ng-template>
                        </p-multiSelect>
                    </div> -->
                    <div class="md:col-3">
                        <h6>Category</h6>
                        <app-control-osa-category
                            (outValue)="selectedCategory($event)"
                        ></app-control-osa-category>
                    </div>
                    <div class="md:col-3">
                        <h6>Group</h6>
                        <p-dropdown
                            [options]="group_product_data"
                            [(ngModel)]="group_product_filter"
                            placeholder="Select a group product"
                            [showClear]="true"
                            optionLabel="name"
                            [style]="{ minWidth: '100%' }"
                        />
                    </div>
                    <div class="md:col-3">
                        <h6>QRCode</h6>
                        <input
                            [style]="{ minWidth: '100%' }"
                            type="text"
                            pInputText
                            [(ngModel)]="barcode"
                            placeholder="List QRCode"
                        />
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="grid">
        <div class="col-12">
            <div class="row">
                <p-toolbar>
                    <div class="p-toolbar-group-left flex flex-wrap">
                        <button
                            pButton
                            type="button "
                            label="Filter"
                            [loading]="isLoading_Filter"
                            icon="pi pi-search "
                            (click)="filter(1)"
                            class="p-button-sm mr-2 mt-2"
                        ></button>

                        <button
                            type="button"
                            class="p-button-sm mr-2 mt-2"
                            pButton
                            pRipple
                            icon="pi pi-plus"
                            label="Create"
                            (click)="createProduct()"
                        ></button>

                        <button
                            type="button"
                            (click)="export()"
                            label="Raw data"
                            pButton
                            pRipple
                            icon="pi pi-file-excel"
                            style="float: right"
                            class="p-button-sm mr-2 mt-2"
                        ></button>

                        <p-splitButton
                            label="Master"
                            icon="pi pi-bars"
                            styleClass="p-button-sm mr-2 mt-2"
                            [model]="items"
                        ></p-splitButton>

                        <!-- <p-splitButton label="Import Data" icon="pi pi-bars" styleClass="p-button-sm mr-2 mt-2"
                            [model]="itemsImport"></p-splitButton> -->

                        <button
                            type="button"
                            (click)="ShowHideTemplate(1)"
                            label="Import Excel"
                            pButton
                            pRipple
                            class="p-button-sm mr-2 mt-2"
                            icon="pi pi-upload"
                        ></button>

                        <i class="pi pi-bars p-toolbar-separator"></i>

                        <button
                            pButton
                            type="button"
                            pTooltip="Show Filter"
                            pStyleClass=".box"
                            enterClass="hidden"
                            enterActiveClass="fadeinup"
                            (click)="ShowHideFilter()"
                            tooltipPosition="top"
                            icon="pi pi-eye"
                            class="p-button-success mr-2 mt-2"
                            [ngStyle]="{
                                display: showFilter == 1 ? 'none' : 'flex'
                            }"
                        ></button>

                        <button
                            pButton
                            type="button"
                            pTooltip="Hide Filter"
                            (click)="ShowHideFilter()"
                            tooltipPosition="top"
                            icon="pi pi-eye-slash"
                            class="p-button-warning mr-2 mt-2"
                            pStyleClass=".box"
                            leaveActiveClass="fadeoutup"
                            leaveToClass="hidden"
                            [ngStyle]="{
                                display: showFilter == 0 ? 'none' : 'flex'
                            }"
                        ></button>
                    </div>
                </p-toolbar>
            </div>
        </div>
    </div>

    <div class="card" *ngIf="showTemplate == 1">
        <p-toolbar>
            <div class="p-toolbar-group-start">
                <div class="text-center" class="mr-2">
                    <input
                        class="form-control"
                        type="file"
                        (change)="onChange($event)"
                        #myInputFile
                    />
                </div>

                <!-- <a [href]="template_product"> -->
                <button
                    pButton
                    pRipple
                    label="Get Template Product"
                    icon="pi pi-file-export"
                    (click)="getTemplate()"
                    class="p-button-sm p-button-info mr-2"
                ></button>
                <!-- </a>  -->

                <button
                    pButton
                    pRipple
                    (click)="importTemplate()"
                    class="ml-2"
                    label="Upload File Product"
                    icon="pi pi-upload"
                    class="p-button-sm p-button-success"
                ></button>
            </div>
        </p-toolbar>

        <hr />

        <div class="card" *ngIf="dataError">
            <p-table
                #dt
                [columns]="cols"
                [value]="dataError"
                selectionMode="multiple"
                [exportHeader]="'customExportHeader'"
                [tableStyle]="{ 'min-width': '50rem' }"
            >
                <ng-template pTemplate="caption">
                    <div class="flex">
                        <button
                            type="button"
                            pButton
                            pRipple
                            icon="pi pi-file-excel"
                            (click)="exportExcel()"
                            class="p-button-success ml-auto"
                            pTooltip="XLS"
                            tooltipPosition="bottom"
                        ></button>
                        <!-- 'jspdf' - 'jspdf-autotable' -->
                        <!-- <button type="button" pButton pRipple icon="pi pi-file-pdf" (click)="exportPdf('jspdf', 'jspdf-autotable' )" class="p-button-warning ml-auto" pTooltip="PDF" tooltipPosition="bottom"></button> -->
                    </div>
                </ng-template>

                <ng-template pTemplate="header" let-columns>
                    <tr>
                        <th *ngFor="let col of columns">
                            {{ col.header }}
                        </th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-rowData let-columns="columns">
                    <tr [pSelectableRow]="rowData">
                        <td *ngFor="let col of columns">
                            <p
                                *ngIf="
                                    col.field !== 'image' && rowData[col.field]
                                "
                            >
                                {{ rowData[col.field] }}
                            </p>
                            <p-image
                                *ngIf="
                                    col.field === 'image' && rowData[col.field]
                                "
                                [src]="rowData[col.field]"
                                alt="Image"
                                width="50"
                                height="50"
                                [preview]="true"
                            ></p-image>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>

        <hr />
        <div class="card" *ngIf="dataMessError">
            <div class="col-12">
                <div class="grid">
                    <div class="col-1 font-bold">Error Name :</div>
                    <div class="col-11">
                        {{ dataMessError }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <hr />
    <div class="card">
        <p-table
            selectionMode="single"
            dataKey="product_id"
            *ngIf="ListProduct && ListProduct.length > 0"
            [scrollable]="true"
            [value]="ListProduct"
            styleClass="p-datatable-gridlines"
            aria-sort="ascending"
            sortField="order"
            [tableStyle]="{ 'min-width': '50rem' }"
        >
            <ng-template pTemplate="caption">
                Total Item: {{ totalRecords }}

                <p-paginator
                    (onPageChange)="onPageChange($event)"
                    [first]="first"
                    [rows]="rows"
                    [totalRecords]="totalRecords"
                    [rowsPerPageOptions]="[20, 50, 100]"
                ></p-paginator>
            </ng-template>

            <ng-template pTemplate="header">
                <tr>
                    <th class="text-center" style="width: 5rem"></th>
                    <th style="width: 5%" class="text-center">RowNum</th>
                    <th class="text-center">Product Code</th>
                    <th class="text-center">Product Name</th>
                    <th class="text-center">Image</th>
                    <th class="text-center">Price</th>
                    <th class="text-center">Unit</th>
                    <th class="text-center">Size</th>
                    <th class="text-center">QRCode</th>
                    <th class="text-center">Category Name EN*</th>
                    <th class="text-center">Category Name VI*</th>
                    <th class="text-center">Group code</th>
                    <th class="text-center">Group Name</th>
                    <th class="text-center">Order</th>
                    <th class="text-center" style="width: 5%">Action</th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-product let-expanded="expanded">
                <tr>
                    <td>
                        <button
                            type="button"
                            pButton
                            pRipple
                            [pRowToggler]="product"
                            class="p-button-text p-button-rounded p-button-plain"
                            [icon]="
                                expanded
                                    ? 'pi pi-chevron-down'
                                    : 'pi pi-chevron-right'
                            "
                        ></button>
                    </td>

                    <td class="text-center">{{ product.RowNum }}</td>
                    <td>{{ product.product_code }}</td>
                    <td>{{ product.product_name }}</td>
                    <td class="text-center">
                        <p-image
                            (onImageError)="onImageErrorImage($event, 'image')"
                            [src]="product.image"
                            alt="Image"
                            width="50"
                            [preview]="true"
                        ></p-image>
                    </td>
                    <td class="text-center">{{ product.price }}</td>
                    <td class="text-center">{{ product.unit }}</td>
                    <td class="text-center">{{ product.size }}</td>
                    <td class="text-center">{{ product.barcode }}</td>
                    <td>
                        <div>
                            [{{ product.category_id }}] -
                            {{ product.category_name }}
                        </div>
                    </td>
                    <td>
                        <div>
                            [{{ product.category_id }}] -
                            {{ product.category_name_vi }}
                        </div>
                    </td>
                    <td class="text-center">{{ product.group_code }}</td>
                    <td class="text-center">{{ product.group_name }}</td>
                    <td class="text-center">{{ product.order }}</td>
                    <td class="text-center">
                        <!-- *ngIf="userProfile.employee_id == product.created_by" -->
                        <p-button
                            pTooltip="Update info product"
                            (click)="updateProduct(product)"
                            tooltipPosition="left"
                            icon="pi pi-file-edit"
                            styleClass="p-button-rounded p-button-text p-button-raised "
                        ></p-button>
                    </td>
                </tr>
            </ng-template>

            <ng-template pTemplate="rowexpansion" let-product>
                <tr>
                    <td colspan="100% ">
                        <div class="p-3">
                            <app-product-details
                                (newItemEventProduct)="itemProduct($event)"
                                [inValue]="product"
                                [action]="'view'"
                            ></app-product-details>
                        </div>
                    </td>
                </tr>
            </ng-template>

            <ng-template pTemplate="summary ">
                <p-paginator
                    (onPageChange)="onPageChange($event)"
                    [first]="first"
                    [rows]="rows"
                    [totalRecords]="totalRecords"
                    [rowsPerPageOptions]="[20, 50, 100]"
                ></p-paginator>
            </ng-template>
        </p-table>
        <div
            class="card flex justify-content-center justify-content-between text-center"
            *ngIf="ListProduct && ListProduct.length == 0"
            style="float: right"
        >
            <h5>No data</h5>
        </div>
    </div>

    <p-dialog
        header="Create product"
        [modal]="true"
        [(visible)]="producrtCreate"
        [style]="{ width: '50vw' }"
        [maximizable]="true"
    >
        <app-product-details
            (newItemEvent)="addItem($event)"
            [inValue]="ListProduct"
            [action]="'create'"
        ></app-product-details>
    </p-dialog>

    <p-dialog
        header="Update product"
        [modal]="true"
        [(visible)]="productUpdate"
        [style]="{ width: '50vw' }"
        [maximizable]="true"
    >
        <!-- <label for="category_name">Category Name</label> -->

        <app-product-details
            (newItemEventUpdate)="addItemUpdate($event)"
            [inValue]="Product"
            [action]="'update'"
        ></app-product-details>
    </p-dialog>
</section>
