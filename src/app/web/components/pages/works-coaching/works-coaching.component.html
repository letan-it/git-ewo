<!-- eslint-disable @angular-eslint/template/eqeqeq -->
<app-breadcrumb-menu [items_menu]="items_menu" [home]="home"></app-breadcrumb-menu>

<div class="grid animation-duration-500 box">
    <div class="col-12">
        <div class="card">
            <div class="row">
                <div class="md:col-2 p-fluid">
                    <h6>{{ GetLanguage("f_start_field_date") }}</h6>
                    <input pInputText id="dateStart" class="text-center font-bold mr-2" type="date"
                        [(ngModel)]="dateStart" />
                    <!-- <p-calendar [(ngModel)]="dateStart"></p-calendar> -->
                </div>
                <div class="md:col-2 p-fluid">
                    <h6>{{ GetLanguage("f_end_field_date") }}</h6>
                    <input pInputText id="dateEnd" class="text-center font-bold mr-2" type="date"
                        [(ngModel)]="dateEnd" />
                    <!-- <p-calendar [(ngModel)]="dateEnd"></p-calendar> -->
                </div>

                <div class="md:col-3" *ngIf="userProfile.employee_type_id != 7">
                    <h6>{{ GetLanguage("f_employee_checker") }}</h6>
                    <app-control-employee-list (outValue)="selectASM($event)" [project_id]="project_id"
                        [placeholder]="GetLanguage('f_employee_checker')" [employee_type_id]="'7 8'">
                    </app-control-employee-list>
                </div>

                <div class="md:col-3" *ngIf="userProfile.employee_type_id != 7">
                    <h6>{{ GetLanguage("f_employee") }}</h6>
                    <app-control-employee-list (outValue)="selectSS($event)" [project_id]="project_id"
                        [placeholder]="GetLanguage('lb_select_employee')" [employee_type_id]="'7 8'">
                    </app-control-employee-list>
                </div>
            </div>
            <div class="row">
                <div class="md:col-3">
                    <h6>{{ GetLanguage("f_field_type") }}</h6>
                    <p-dropdown [options]="FieldTypeResult" [showClear]="true" [filter]="true" filterBy="NameVN"
                        (onClear)="clearFieldType()" [style]="{ minWidth: '100%' }" [(ngModel)]="selectFieldTypeResult"
                        placeholder="Select a Field Type" optionLabel="NameVN">
                        <ng-template let-filterFieldTypeResult pTemplate="item">
                            <div *ngIf="filterFieldTypeResult.NameVN === 'Thành công'; else Active">
                                <div class="flex align-items-center gap-2">
                                    <i class="pi pi-check-circle" style="font-size: 1.2rem; color: green;"></i>
                                    <div>{{ filterFieldTypeResult.NameVN }}</div>
                                </div>
                            </div>
                            <ng-template #Active>
                                <div class="flex align-items-center gap-2">
                                    <i class="pi pi-times-circle" style="font-size: 1.2rem; color: red;"></i>
                                    <div>{{ filterFieldTypeResult.NameVN }}</div>
                                </div>
                            </ng-template>
                        </ng-template>
                    </p-dropdown>
                </div>
                <div class="md:col-3">
                    <h6>{{ GetLanguage("f_confirm_result") }}</h6>
                    <p-dropdown [options]="FieldTypeConfirm" [showClear]="true" [filter]="true" filterBy="NameVN"
                        (onClear)="clearConfirmResult()" [style]="{ minWidth: '100%' }"
                        [(ngModel)]="selectFieldTypeConfirm" placeholder="Select a Confirm Result" optionLabel="NameVN">
                        <ng-template let-filterFieldTypeConfirm pTemplate="item">
                            <div *ngIf="filterFieldTypeConfirm.NameVN === 'ĐỒNG Ý'; else Active">
                                <div class="flex align-items-center gap-2">
                                    <i class="pi pi-check-circle" style="font-size: 1.2rem; color: green;"></i>
                                    <div>{{ filterFieldTypeConfirm.NameVN }}</div>
                                </div>
                            </div>
                            <ng-template #Active>
                                <div class="flex align-items-center gap-2">
                                    <i class="pi pi-times-circle" style="font-size: 1.2rem; color: red;"></i>
                                    <div>{{ filterFieldTypeConfirm.NameVN }}</div>
                                </div>
                            </ng-template>
                        </ng-template>
                    </p-dropdown>
                </div>
            </div>
            <div class="row">
                <div class="md:col-4">
                    <h6>{{ GetLanguage("f_province") }}</h6>
                    <app-control-province (outValue)="selectProvince($event)"></app-control-province>
                </div>
                <div class="md:col-4">
                    <h6>{{ GetLanguage("f_district") }}</h6>
                    <app-control-district [inValue]="item_Province" [inValueProvince]="item_Province"
                        (outValue)="selectDistrict($event)"></app-control-district>
                </div>
                <div class="md:col-4">
                    <h6>{{ GetLanguage("f_ward") }}</h6>
                    <app-control-ward [inValue]="item_District" [inValueProvince]="item_Province"
                        [inValueDistrict]="item_District" (outValue)="selectWard($event)"></app-control-ward>
                </div>
            </div>

            <div class="row">
                <div class="md:col-2">
                    <h6>{{ GetLanguage("f_shopcode") }}</h6>
                    <input [style]="{ minWidth: '100%' }" type="text" pInputText [(ngModel)]="shop_code"
                        placeholder="Shop Code" />
                </div>

                <div class="md:col-3" *ngIf="projectId == 20">
                    <h6>{{ GetLanguage("f_shopname") }}</h6>
                    <input [style]="{ minWidth: '100%' }" type="text" pInputText [(ngModel)]="shop_name"
                        placeholder="Shop Name" (ngModelChange)="selectShopNameOutlet($event)" />
                </div>
                <div class="md:col-3">
                    <h6>{{ GetLanguage("f_survey_filter") }}</h6>
                    <app-control-survey-list (outValue)="selectSurveyReport($event)" [typeSurvey]="[5]">
                    </app-control-survey-list>
                </div>
                <div class="md:col-5">
                    <h6>{{ GetLanguage("f_report_uuid") }}</h6>
                    <input [style]="{ minWidth: '100%' }" type="text" pInputText [(ngModel)]="uuid"
                        placeholder="id/uuid list" />
                </div>
            </div>
        </div>
    </div>
</div>

<!-- toolbar -->
<div class="grid">
    <div class="col-12">
        <p-toolbar>
            <div class="p-toolbar-group-left flex flex-wrap align-items-center">
                <button pButton type="button" [label]="GetLanguage('action.filter')" [loading]="isLoading_Filter"
                    icon="pi pi-search" (click)="filter(1)" class="p-button-sm mr-2"></button>

                <p-splitButton *ngIf="
                        totalRecords > 0 &&
                        checkUserCUS() == false &&
                        itemsData.length > 0
                    " [label]="GetLanguage('action.rawdata')" icon="pi pi-file-export" styleClass="p-button-sm mr-2"
                    [model]="itemsData"></p-splitButton>

                <i class="pi pi-bars p-toolbar-separator"></i>

                <button pButton type="button" pTooltip="Show Filter" pStyleClass=".box" enterClass="hidden"
                    enterActiveClass="fadeinup" (click)="ShowHideFilter()" tooltipPosition="top" icon="pi pi-eye"
                    class="p-button-success mr-2 mt-2"
                    [ngStyle]="{ display: showFilter == 1 ? 'none' : 'flex' }"></button>

                <button pButton type="button" pTooltip="Hide Filter" (click)="ShowHideFilter()" tooltipPosition="top"
                    icon="pi pi-eye-slash" class="p-button-warning mr-2 mt-2" pStyleClass=".box"
                    leaveActiveClass="fadeoutup" leaveToClass="hidden"
                    [ngStyle]="{ display: showFilter == 0 ? 'none' : 'flex' }"></button>

                <!-- <app-control-survey-list (outValue)="selectSurveyReport($event)" [typeSurvey]="[5]">
                </app-control-survey-list>
                <button pButton type="button" class="p-button-sm ml-2 mr-2" 
                    [label]="GetLanguage('action.download')" icon="pi pi-download"></button> -->
                <app-control-survey-list *ngIf="is_coaching_survey == 1" (outValue)="selectCoachingSurvey($event)"
                    [typeSurvey]="[5]"></app-control-survey-list>
                <button pButton type="button" (click)="export_COACHING()" *ngIf="is_coaching_survey == 1"
                    label="download" [loading]="isLoading_Filter" icon="pi pi-arrow-down"
                    class="p-button-sm mr-2 ml-2"></button>

                <app-control-survey-list *ngIf="download_survey == 1 || download_survey == 2"
                    (outValue)="selectSurvey($event)" [typeSurvey]="[1, 2]"></app-control-survey-list>
            </div>

            <div class="p-toolbar-group-end">
                <button pButton type="button" (click)="OK('display_model')" *ngIf="project_id == 4" label="MODEL EDIT"
                    [loading]="isLoading_Filter" icon="pi pi-arrow-up"
                    class="p-button-sm p-button-success mr-2 ml-2"></button>
            </div>
        </p-toolbar>

        <!-- <p-messages [value]="msgs"></p-messages> -->
    </div>
</div>
<hr />

<div class="card" *ngIf="is_loadForm == 1">
    <p-table [value]="products" responsiveLayout="scroll">
        <ng-template pTemplate="caption">
            Total Item: {{ totalRecords }}
            <p-paginator (onPageChange)="onPageChange($event)" [first]="first" [rows]="rows"
                [totalRecords]="totalRecords" [rowsPerPageOptions]="[20, 50, 100]"></p-paginator>
        </ng-template>
        <ng-template pTemplate="header">
            <tr>
                <th style="width: 5rem"></th>
                <th class="text-center">Employee</th>
                <th class="text-center">Employee Checker</th>
                <th class="text-center">Field Date</th>
                <th class="text-center">Field Test</th>
                <th class="text-center">Shop</th>
                <th class="text-center">Address</th>
                <th class="text-center">Result</th>
                <th class="text-center">Score</th>
                <th class="text-center">Field Type</th>
                <th class="text-center">Confirm</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-product>
            <tr>
                <td>
                    <p-skeleton shape="circle" size="2rem" styleClass="mr-2"></p-skeleton>
                </td>
                <td>
                    <p-skeleton></p-skeleton>
                </td>
                <td>
                    <p-skeleton></p-skeleton>
                </td>
                <td>
                    <p-skeleton></p-skeleton>
                </td>
                <td>
                    <p-skeleton></p-skeleton>
                </td>
                <td>
                    <p-skeleton></p-skeleton>
                </td>
                <td>
                    <p-skeleton></p-skeleton>
                </td>
                <td>
                    <p-skeleton></p-skeleton>
                </td>
                <td>
                    <p-skeleton></p-skeleton>
                </td>
                <td>
                    <p-skeleton></p-skeleton>
                </td>
                <td>
                    <p-skeleton></p-skeleton>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>

<div class="card" *ngIf="is_loadForm == 0">
    <p-table selectionMode="single " dataKey="id" *ngIf="ListReportWork && ListReportWork.length > 0"
        [value]="ListReportWork" styleClass="p-datatable-gridlines" [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template pTemplate="caption">
            Total Item: {{ totalRecords }}
            <p-paginator (onPageChange)="onPageChange($event)" [first]="first" [rows]="rows"
                [totalRecords]="totalRecords" [rowsPerPageOptions]="[20, 50, 100]"></p-paginator>
        </ng-template>

        <ng-template pTemplate="header">
            <tr>
                <th style="width: 5rem"></th>
                <th class="text-center">Employee</th>
                <th class="text-center">Employee Checker</th>
                <th class="text-center">Field Date</th>
                <th class="text-center">Field Test</th>
                <th class="text-center">Shop</th>
                <th class="text-center">Address</th>
                <th class="text-center">Result</th>
                <th class="text-center">Score</th>
                <th class="text-center">Field Type</th>
                <th class="text-center">Confirm</th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-report let-expanded="expanded">
            <tr>
                <td>
                    <button type="button" pButton pRipple [pRowToggler]="report"
                        class="p-button-text p-button-rounded p-button-plain" [icon]="
                            expanded
                                ? 'pi pi-chevron-down'
                                : 'pi pi-chevron-right'
                        "></button>
                </td>
                <td (click)="op.toggle($event)">
                    <p-overlayPanel #op>
                        <p-image [src]="
                                report.image_face_left
                                    ? report.image_face_left
                                    : 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTEjbot8iMZv8bsuEqntHBglMD2BTCB1MlxLqd5Kr8aqw&s'
                            " alt="avatar" width="150px" (onImageError)="
                                onImageErrorImage(report.RowNum, 'left')
                            " />
                        <p-image [src]="
                                report.employee_image
                                    ? report.employee_image
                                    : 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTEjbot8iMZv8bsuEqntHBglMD2BTCB1MlxLqd5Kr8aqw&s'
                            " alt="avatar" width="150px" (onImageError)="
                                onImageErrorImage(report.RowNum, 'mid')
                            " />
                        <p-image [src]="
                                report.image_face_right
                                    ? report.image_face_right
                                    : 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTEjbot8iMZv8bsuEqntHBglMD2BTCB1MlxLqd5Kr8aqw&s'
                            " alt="avatar" width="150px" (onImageError)="
                                onImageErrorImage(report.RowNum, 'right')
                            " />
                    </p-overlayPanel>
                    <label *ngIf="
                            report.employee_name != null &&
                            report.employee_code != null
                        ">
                        <b style="color: green">{{ report.employee_code }} </b>- {{ report.employee_name }}
                    </label>
                </td>
                <td>
                    <label *ngIf="report.checker_code != null">
                        <b style="color: green"> {{ report.checker_code }} </b>- {{ report.checker_name }}
                    </label>
                </td>
                <td class="text-center">{{ report.field_date_format | date : "dd/MM/yyyy" }}</td>
                <td class="text-center">{{ report.survey_name }}</td>

                <td (click)="op1.toggle($event)">
                    <p-overlayPanel #op1>
                        <p-image [src]="
                                report.image
                                    ? report.image
                                    : 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTEjbot8iMZv8bsuEqntHBglMD2BTCB1MlxLqd5Kr8aqw&s'
                            " alt="avatar" width="150px"></p-image>
                    </p-overlayPanel>

                    <label *ngIf="
                            report.shop_code != null &&
                            report.shop_name != null &&
                            report.shop_address != null
                        ">
                        <b style="color: green">{{ report.shop_code }} </b>- {{ report.shop_name }}
                    </label>
                </td>
                <td>{{ report.shop_address }}</td>
                <td class="text-center">
                    {{ report.result }}
                </td>
                <td class="text-center">
                    <b style="color: green">{{ report.result_value }}</b>
                </td>
                <td class="w-1" [pTooltip]="report.field_type_name">
                    <div class="flex flex-row w-full h-fit align-items-center justify-content-center gap-2">
                        <!-- <app-control-status-check [status]="report.field_type"></app-control-status-check> -->
                        <span class="text-sm">{{report.file_type_name}}</span>
                    </div>
                </td>
                <td class="w-1">
                    <div class="flex flex-column w-full h-fit align-items-start justify-content-start gap-2">
                        <div class="flex flex-row w-full h-fit align-items-center justify-content-start gap-3">
                            <!-- <app-control-status-check [status]="report.confirm_result"></app-control-status-check> -->
                            <span class="text-sm">{{report.confirm_name}}</span>
                            <i *ngIf="report.confirm_note !== null || report.confirm_note === ''" class="pi pi-comment"
                                [pTooltip]="report.confirm_note" style="font-size: 1.5rem"></i>
                        </div>
                        <!-- <div class="flex flex-row w-full h-fit align-items-center justify-content-start gap-3">
                            
                            <span class="text-sm">{{report.confirm_note}}</span>
                        </div> -->
                    </div>
                </td>
            </tr>
        </ng-template>

        <ng-template pTemplate="rowexpansion" let-report>
            <tr style="text-align: center">
                <td colspan="100%">
                    <div class="w-full" style="width: 100% !important">
                        <!-- max-width: 1450px; -->
                        <!-- <app-works-coaching-details [inValue]="report" [action]="'view'"
                            [FilterSurvey]="item_SurveyReport"></app-works-coaching-details> -->
                        <app-kpi-field-coaching [inValue]="report"
                            (outValue)="loadDataCoaching(report.project_id, report.id)">
                        </app-kpi-field-coaching>
                    </div>
                </td>
            </tr>
        </ng-template>

        <ng-template pTemplate="summary">
            <p-paginator (onPageChange)="onPageChange($event)" [first]="first" [rows]="rows"
                [totalRecords]="totalRecords" [rowsPerPageOptions]="[20, 50, 100]"></p-paginator>
        </ng-template>
    </p-table>
    <div class="card flex justify-content-center justify-content-between text-center"
        *ngIf="ListReportWork && ListReportWork.length == 0" style="float: right">
        <h5>No data</h5>
    </div>
</div>
